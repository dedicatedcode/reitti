<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="geocoding-response-content">
    <div th:if="${context == 'edit'}" class="drawer-header">
        <h3 class="drawer-title" th:text="#{places.geocoding.response.title(${place.name()})}">Geocoding Response for Place</h3>
        <button type="button" class="drawer-close">&times;</button>
    </div>
    
    <div th:if="${context != 'edit'}">
        <h2 th:text="#{places.geocoding.response.title(${place.name()})}">Geocoding Response for Place</h2>

        <div style="margin-bottom: 20px;">
            <button class="btn" 
                    th:attr="hx-get=${'/settings/places/places-content?page=' + currentPage + '&search=' + search}"
                    hx-target="#places-management"
                    hx-swap="innerHTML"
                    th:text="#{places.geocoding.response.back}">Back to Places</button>
        </div>
    </div>

    <div th:class="${context == 'edit' ? 'drawer-content' : ''}">

    <div class="settings-card">
        <h3 th:text="${place.name()}">Place Name</h3>
        <p><strong th:text="#{places.address.label}">Address:</strong> <span th:text="${place.address() ?: #messages.msg('places.address.not.available')}">Address</span></p>
        <p><strong th:text="#{places.coordinates.label}">Coordinates:</strong> <span th:text="${place.lat() + ', ' + place.lng()}">Coordinates</span></p>
    </div>

    <div th:if="${!geocodingResponses.isEmpty()}" class="settings-card">
        <h3>Geocoding Responses</h3>
        <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2);">
            <table>
                <thead>
                <tr>
                    <th th:text="#{places.geocoding.response.provider}">Provider</th>
                    <th th:text="#{places.geocoding.response.status}">Status</th>
                    <th th:text="#{places.geocoding.response.fetched.at}">Fetched At</th>
                    <th th:text="#{places.geocoding.response.error.details}">Error Details</th>
                    <th th:text="#{places.geocoding.response.raw.data}">Raw Data</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="response, iterStat : ${geocodingResponses}">
                    <td th:text="${response.providerName}">Provider Name</td>
                    <td th:text="${response.status}">Status</td>
                    <td th:text="${#temporals.format(response.fetchedAt, 'yyyy-MM-dd HH:mm:ss')}">Fetched At</td>
                    <td><span  th:if="${response.errorDetails}" th:text="${response.errorDetails}">Error Details</span></td>
                    <td>
                        <pre style="background-color: rgba(255,255,255,0.1); padding: 15px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto;"
                             th:text="${response.rawData}"></pre>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div th:if="${geocodingResponses.isEmpty()}" class="settings-card">
        <p th:text="#{places.geocoding.response.no.data}">No geocoding response is available for this place</p>
    </div>
    </div>
</div>

<div>
    <div class="settings-card" style="margin-bottom: 20px;">
        <h3 th:text="#{places.edit.visit.stats.title}">Visit Statistics</h3>
        <div th:if="${visitStats != null && visitStats.totalVisits > 0}" class="visit-stats">
            <p th:if="${visitStats.firstVisit != null && visitStats.lastVisit != null}">
                <span th:utext="#{places.edit.visit.complete(${place.name()}, ${visitStats.totalVisits}, 
                    '&lt;a href=&quot;/?date=' + ${#temporals.format(visitStats.firstVisit, 'yyyy-MM-dd')} + '&quot; target=&quot;_blank&quot;&gt;' + ${#temporals.format(visitStats.firstVisit, 'yyyy-MM-dd HH:mm')} + '&lt;/a&gt;',
                    '&lt;a href=&quot;/?date=' + ${#temporals.format(visitStats.lastVisit, 'yyyy-MM-dd')} + '&quot; target=&quot;_blank&quot;&gt;' + ${#temporals.format(visitStats.lastVisit, 'yyyy-MM-dd HH:mm')} + '&lt;/a&gt;')}">
                    Complete visit summary
                </span>
            </p>
            <p th:if="${visitStats.firstVisit == null || visitStats.lastVisit == null}">
                <span th:text="#{places.edit.visit.summary(${place.name()}, ${visitStats.totalVisits})}">You visited this place X times.</span>
            </p>
        </div>
        <div th:if="${visitStats == null || visitStats.totalVisits == 0}" class="no-visits">
            <p th:text="#{places.edit.no.visits}">No visits recorded for this place yet.</p>
        </div>
    </div>

</div>

</body>
</html>
