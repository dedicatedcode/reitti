<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- Block type selection fragment -->
<div th:fragment="block-type-selection" class="block-type-selection">
    <h3>Select Block Type</h3>
    <div class="block-type-grid">
        <button type="button" 
                class="block-type-option"
                th:attr="hx-get=@{/memories/{id}/blocks/new(id=${memoryId}, type='TEXT')}"
                hx-target=".blocks-add-area"
                hx-swap="innerHTML">
            <span>Text Block</span>
            <p>Add text content with headlines and paragraphs</p>
        </button>
        
        <button type="button" 
                class="block-type-option"
                th:attr="hx-get=@{/memories/{id}/blocks/new(id=${memoryId}, type='VISIT')}"
                hx-target=".blocks-add-area"
                hx-swap="innerHTML">
            <span>Visit Block</span>
            <p>Add a location you visited during this memory</p>
        </button>
        
        <button type="button" 
                class="block-type-option"
                th:attr="hx-get=@{/memories/{id}/blocks/new(id=${memoryId}, type='TRIP')}"
                hx-target=".blocks-add-area"
                hx-swap="innerHTML">
            <span>Trip Block</span>
            <p>Add a journey or route from this memory</p>
        </button>
        
        <button type="button" 
                class="block-type-option"
                th:attr="hx-get=@{/memories/{id}/blocks/new(id=${memoryId}, type='IMAGE_GALLERY')}"
                hx-target=".blocks-add-area"
                hx-swap="innerHTML">
            <span>Image Gallery</span>
            <p>Add a collection of photos from this memory</p>
        </button>
    </div>
    
    <div class="form-actions">
        <button type="button" 
                class="btn btn-secondary"
                hx-get="/memories/fragments/empty"
                hx-target=".blocks-add-area"
                hx-swap="innerHTML">Cancel</button>
    </div>
</div>

<!-- Empty fragment for clearing content -->
<div th:fragment="empty"></div>

<!-- Text block form -->
<div th:fragment="text-block-form" class="block-form">
    <h3>Add Text Block</h3>
    <form th:action="@{/memories/{id}/blocks/text(id=${memoryId})}" method="post" hx-target="body" hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="headline">Headline</label>
            <input type="text" id="headline" name="headline" class="form-control" placeholder="Enter headline">
        </div>
        
        <div class="form-group">
            <label for="content">Content</label>
            <textarea id="content" name="content" class="form-control" rows="6" placeholder="Enter your text content"></textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" 
                    class="btn btn-secondary"
                    hx-get="/memories/fragments/empty"
                    hx-target=".blocks-add-area"
                    hx-swap="innerHTML">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Block</button>
        </div>
    </form>
</div>

<!-- Visit block form -->
<div th:fragment="visit-block-form" class="block-form">
    <h3>Add Visit Block</h3>
    <form th:action="@{/memories/{id}/blocks/visit(id=${memoryId})}" method="post" hx-target="body" hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="visitId">Select Visit</label>
            <select id="visitId" name="visitId" class="form-control" required>
                <option value="">Choose a visit...</option>
                <!-- TODO: Load visits from the memory date range -->
            </select>
        </div>
        
        <div class="form-actions">
            <button type="button" 
                    class="btn btn-secondary"
                    hx-get="/memories/fragments/empty"
                    hx-target=".blocks-add-area"
                    hx-swap="innerHTML">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Block</button>
        </div>
    </form>
</div>

<!-- Trip block form -->
<div th:fragment="trip-block-form" class="block-form">
    <h3>Add Trip Block</h3>
    <form th:action="@{/memories/{id}/blocks/trip(id=${memoryId})}" method="post" hx-target="body" hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="tripId">Select Trip</label>
            <select id="tripId" name="tripId" class="form-control" required>
                <option value="">Choose a trip...</option>
                <!-- TODO: Load trips from the memory date range -->
            </select>
        </div>
        
        <div class="form-actions">
            <button type="button" 
                    class="btn btn-secondary"
                    hx-get="/memories/fragments/empty"
                    hx-target=".blocks-add-area"
                    hx-swap="innerHTML">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Block</button>
        </div>
    </form>
</div>

<!-- Image gallery block form -->
<div th:fragment="image-gallery-block-form" class="block-form">
    <h3>Add Image Gallery Block</h3>
    <form th:action="@{/memories/{id}/blocks/image-gallery(id=${memoryId})}" method="post" hx-target="body" hx-swap="innerHTML">
        
        <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input type="url" id="imageUrl" name="imageUrl" class="form-control" placeholder="https://example.com/image.jpg" required>
        </div>
        
        <div class="form-group">
            <label for="caption">Caption</label>
            <input type="text" id="caption" name="caption" class="form-control" placeholder="Enter image caption">
        </div>
        
        <div class="form-actions">
            <button type="button" 
                    class="btn btn-secondary"
                    hx-get="/memories/fragments/empty"
                    hx-target=".blocks-add-area"
                    hx-swap="innerHTML">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Block</button>
        </div>
    </form>
</div>

<!-- Memory block fragment -->
<div th:fragment="memory-block" class="memory-block" th:attr="data-block-id=${block.id}, data-block-type=${block.blockType.name()}">
    <div class="block-header">
        <span class="block-type-badge" th:text="${block.blockType.name()}">BLOCK TYPE</span>
        <div class="block-actions">
            <button class="btn-icon" th:onclick="'editBlock(' + ${block.id} + ')'"><i class="lni lni-pencil"></i></button>
                <button type="button" 
                        class="btn-icon danger" 
                        th:attr="hx-delete=@{/memories/{memoryId}/blocks/{blockId}(memoryId=${memory.id}, blockId=${block.id})}"
                        hx-target="closest .memory-block"
                        hx-swap="outerHTML"
                        hx-confirm="Delete this block?"
                        onclick="return confirm('Delete this block?')">
                    <i class="lni lni-trash"></i>
                </button>
        </div>
    </div>
    <div class="block-content">
        <div th:if="${block.blockType.name() == 'TEXT'}" class="text-block">
            <h3>Text Block</h3>
            <p>Content will be loaded here</p>
        </div>
        <div th:if="${block.blockType.name() == 'VISIT'}" class="visit-block">
            <i class="lni lni-map-marker"></i>
            <p>Visit block</p>
        </div>
        <div th:if="${block.blockType.name() == 'TRIP'}" class="trip-block">
            <i class="lni lni-direction"></i>
            <p>Trip block</p>
        </div>
        <div th:if="${block.blockType.name() == 'IMAGE_GALLERY'}" class="gallery-block">
            <i class="lni lni-gallery"></i>
            <p>Image gallery</p>
        </div>
    </div>
</div>

</body>
</html>
